#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
#############################################################################################################
[include RatOS.cfg]

[ratos]
allow_unsupported_slicer_versions: True

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
#### COMMON #####
[gcode_macro RatOS]
variable_relative_extrusion: True                # True|False = enable relative extrusion mode
variable_force_absolute_position: False           # True|False = force absolute positioning before the print starts
variable_preheat_extruder: True                   # True|False = enable preheating for inductive probes
variable_preheat_extruder_temp: 150               # int = the preheating nozzle temperature
variable_end_print_motors_off: True               # True|False = Keeps the motors for none IDEX printer on after a print ends
variable_macro_travel_speed: 200                  # int = xy macro travel move speed  
variable_macro_travel_accel: 500                 # int = xy macro travel move acceleration
variable_macro_z_speed: 10                        # int = z macro travel move speed
variable_bed_margin_x: [0, 0]                     # [float, float] = left and right bed margin
variable_bed_margin_y: [0, 0]                     # [float, float] = front and back bed margin

#### LIMITS ####
[gcode_macro RatOS]
variable_printable_x_max: 280
variable_printable_y_max: 295

#### HOMING ####
[gcode_macro RatOS]
variable_homing: "sensorless"                    # endstops|sensorless = axis homing method
variable_z_probe: "static"                     # static|stowable = z-probe type
variable_home_y_first: True
variable_safe_home_x: "middle"                 # float|middle = z-homing x location
variable_safe_home_y: "middle"                 # float|middle = z-homing y location
variable_driver_type_x: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_driver_type_y: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_sensorless_x_current: 1.8            # float = stepper driver run current for sensorless x-homing
variable_sensorless_y_current: 1.6            # float = stepper driver run current for sensorless y-homing

#### MESH ####
[gcode_macro RatOS]
variable_calibrate_bed_mesh: True                # True|False = enable bed meshing
variable_adaptive_mesh: True                     # True|False = enable adaptive bed meshing
variable_adaptive_prime_offset_threshold: -1.0   # float = threshold value used for probing sanity checks

#### PARKING ####
[gcode_macro RatOS]
variable_start_print_park_in: "back"     # back|front|center = gantry parking position before the print starts
variable_start_print_park_z_height: 20   # float = toolhead parking z-position before the print starts
variable_end_print_park_in: "back"       # back|front|center = gantry parking position after the print has finished
variable_pause_print_park_in: "back"     # back|front|center = gantry parking position if the print has paused
variable_end_print_park_z_hop: 20        # float = toolhead z-hop after the print has finished

#### PRIMING ####
[gcode_macro RatOS]
variable_nozzle_priming: "false"                     # primeblob|false = To prime, or not to prime, that is the question.
variable_nozzle_prime_start_x: "min"                 # min|max|float = non IDEX priming x-location
variable_nozzle_prime_start_y: "min"                 # min|max|float = non IDEX priming y-location
variable_nozzle_prime_direction: "auto"          # auto|forwards|backwards = non IDEX priming y-direction
variable_nozzle_prime_bridge_fan: 102            # int = priming fan speed 0-255

#### BEACON ####
[gcode_macro RatOS]
variable_bed_heat_soak_time: 120
variable_hotend_heat_soak_time: 120
variable_beacon_bed_mesh_scv: 25                         # int = square corner velocity for beacon proximity bed meshing
variable_beacon_contact_z_homing: False                  # True|False = use beacon contact for z-homing
variable_beacon_contact_start_print_true_zero: True             # True|False = use beacon contact z-calibration
variable_beacon_contact_bed_mesh: False                  # True|False = use beacon contact for bed meshing
variable_beacon_contact_bed_mesh_samples: 2              # int = beacon contact bed mesh probe samples
variable_beacon_contact_z_tilt_adjust: False             # True|False = use beacon contact for z-tilting
variable_beacon_contact_z_tilt_adjust_samples: 2         # int = beacon contact z-tilt probe samples
variable_beacon_contact_prime_probing: True             # True|False = use beacon contact to probe for prime blobs
variable_beacon_contact_true_zero_temp: 150            # int = beacon contact z-calibration nozzle temperature
variable_beacon_contact_expansion_compensation: True    # True|False = use nozzle thermal expansion compensation
variable_beacon_contact_wipe_before_true_zero: True      # enables a nozzle wipe at Y0 before doing the contact calibration
variable_beacon_scan_compensation_enable: True

#### CHAMBER HEATING ####
[gcode_macro RatOS]
variable_chamber_heater_enable: True                      # True|False = enable chamber heater control
variable_chamber_heater_bed_temp: 115                     # int = bed temperature during chamber preheating
variable_chamber_heater_preheating_temp: 150              # int = the temp the generic_heater is set to when preheating the chamber
variable_chamber_heater_heating_temp_offset: 25           # int = the temp offset for the generic_heater, in addition to the target chamber_temp, while printing
variable_chamber_heater_control_external_heater: False    # True|False = automatic heater control for external heater devices
variable_chamber_heater_air_circulation_enable: True      # True|False = uses the part cooling to blow air from the top of the chamber to the bottom when preheating the chamber
variable_chamber_heater_air_circulation_fan_speed: 0.80   # float = the part cooling fan speed that is used to circulate the air when preheating the chamber
variable_chamber_heater_air_circulation_y_pos: 150          # float = toolhead y-pos when circulating the air
variable_chamber_heater_air_circulation_z_pos: 50        # float = toolhead z-pos when circulating the air
variable_chamber_heater_extra_fan_speed: 0             # float = the extra chamber heater fan that is used to circulate the air when preheating the chamber

#### CHAMBER FILTER ####
[gcode_macro RatOS]
variable_chamber_filter_enable: True                     # True|False = enable chamber filter control
variable_chamber_filter_speed: 1.0                       # float = chamber filter fan speed.
variable_chamber_filter_enable_at: "before_print_start"   # before_print_start|after_print_start|print_end = when to enable the filter
variable_chamber_filter_disable_period: 600              # int = disable fan after X seconds after the print ends
variable_chamber_filter_disable_bed_temp: 0              # int = wait for XÂ°C bed temp after the print ends before disabling the filter

### SKEW ###
variable_skew_profile: "CaliLanternSkewCorrection"

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: Follow along from step 6 in the official beacon guide
###    https://docs.beacon3d.com/quickstart/#6-calibrate-beacon
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################
# Enable arcs support
[gcode_arcs]
resolution: 0.1

[exclude_object]

[include timelapse.cfg]

[include custom/printers/doomcube/doomcube.cfg]

[include custom/toolheads/calamity.cfg]

[include AFC/*.cfg]

[include custom/tuning/*]

[include custom/sensors/chamber_thermistor.cfg]

[include custom/fans/*]

[include custom/leds/*]

[include custom/macros.cfg]


[resonance_tester]
accel_chip_x: adxl345 toolboard_t0
accel_chip_y: adxl345 toolboard_t0
probe_points:
	150,150,20
accel_per_hz: 100
sweeping_accel: 400
sweeping_period: 0

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 63.4
shaper_type_y = mzv
shaper_freq_y = 42.4
damping_ratio_x: 0.062 # damping ratio for the X axis
damping_ratio_y: 0.058 # damping ratio for the Y axis

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for your toolhead
#------------------------------------------------------------------------------------------------------------
[extruder]
heater_pin: mcu:e_heater_pin

#control: pid
#pid_kp: 21.673
#pid_ki: 1.338
#pid_kd: 87.776


[heater_bed]
#control: pid
#pid_kp: 68.203
#pid_ki: 2.842
#pid_kd: 409.216


# REMEMBER TO TUNE SENSORLESS HOMING BEFORE ATTEMPTING TO PRINT!
# You'll find instructions in the generated sensorless-homing-*.cfg file(s),
# where you should keep your sensorless homing settings.
# REMEMBER TO CALIBRATE YOUR BEACON!
# Run BEACON_RATOS_CALIBRATE for automatic calibration.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 19.477
#*# pid_ki = 0.860
#*# pid_kd = 110.296
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 58.681
#*# pid_ki = 1.465
#*# pid_kd = 587.539
#*#
#*# [beacon model default]
#*# model_coef = 1.5179356308491858,
#*# 	  1.6729996580618087,
#*# 	  0.7582679593759398,
#*# 	  0.5886749094650784,
#*# 	  -0.1390903347690452,
#*# 	  0.1143481158343418,
#*# 	  0.6152361615758126,
#*# 	  -0.1871006302805762,
#*# 	  -0.15251090275612175,
#*# 	  0.21351080870560551
#*# model_domain = 1.7904817147881186e-07,1.923970067140496e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 78.099117
#*# model_offset = 0.00000
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	0.062727, 0.024510, 0.036011
#*# 	0.011613, 0.010083, -0.015327
#*# 	0.074473, 0.034077, 0.045184
#*# x_count = 3
#*# y_count = 3
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 92.3273
#*# max_x = 207.673
#*# min_y = 92.3273
#*# max_y = 207.673
#*#
#*# [bed_mesh Contact]
#*# version = 1
#*# points =
#*# 	  0.291354, 0.295417, 0.319479, 0.295417, 0.293542, 0.235104, 0.218229, 0.204167, 0.195417, 0.207917, 0.239167, 0.255104, 0.283542, 0.295417, 0.281042
#*# 	  0.305417, 0.312917, 0.312917, 0.295417, 0.283542, 0.235417, 0.202604, 0.203542, 0.196667, 0.215417, 0.227604, 0.270417, 0.284479, 0.284167, 0.294167
#*# 	  0.301979, 0.328542, 0.267604, 0.242604, 0.250104, 0.206979, 0.192292, 0.179167, 0.180417, 0.205729, 0.229167, 0.255104, 0.250729, 0.313542, 0.281667
#*# 	  0.291667, 0.309792, 0.270729, 0.240729, 0.235104, 0.208542, 0.188229, 0.178229, 0.187604, 0.197604, 0.215729, 0.230729, 0.257604, 0.297917, 0.307604
#*# 	  0.243854, 0.234792, 0.221667, 0.213542, 0.215104, 0.169792, 0.169167, 0.152604, 0.160104, 0.164167, 0.194792, 0.216042, 0.227292, 0.254167, 0.285729
#*# 	  0.193542, 0.197604, 0.193854, 0.173854, 0.175417, 0.149792, 0.136667, 0.127604, 0.126979, 0.144792, 0.147917, 0.173229, 0.206354, 0.214167, 0.239167
#*# 	  0.115729, 0.137604, 0.154167, 0.113854, 0.116042, 0.126042, 0.103542, 0.058854, 0.086354, 0.121667, 0.131042, 0.140417, 0.148854, 0.201979, 0.201354
#*# 	  0.069792, 0.063229, 0.081042, 0.065104, 0.068854, 0.053229, 0.032917, 0.046354, 0.051042, 0.065417, 0.104479, 0.119792, 0.118542, 0.152917, 0.190104
#*# 	  0.042604, 0.037917, 0.062292, -0.004583, 0.032292, 0.036354, 0.041667, 0.035104, 0.032917, 0.067292, 0.078542, 0.125417, 0.125729, 0.137604, 0.167604
#*# 	  0.030104, 0.027604, 0.036354, 0.040729, -0.023646, 0.053229, 0.006979, 0.024479, 0.053542, 0.047604, 0.078854, 0.106042, 0.117917, 0.117292, 0.181042
#*# 	  0.006667, -0.008958, 0.028854, -0.001146, -0.007708, -0.022396, 0.002917, 0.011667, 0.002292, 0.023854, 0.056979, 0.072292, 0.104479, 0.151667, 0.164792
#*# 	  -0.006146, -0.011458, -0.002083, 0.011979, -0.013958, -0.003333, -0.019896, -0.019271, -0.018958, 0.029479, 0.051354, 0.110417, 0.117604, 0.125104, 0.149167
#*# 	  0.723854, 0.008229, 0.034792, 0.009479, 0.069167, 0.012292, 0.008854, 0.045417, 0.035729, 0.045729, 0.086042, 0.115729, 0.131979, 0.177292, 0.200417
#*# 	  0.711354, 0.709792, 0.015729, 0.013229, -0.002083, -0.027396, 0.004792, -0.000521, 0.016667, 0.047604, 0.080104, 0.104167, 0.131354, 0.182917, 0.196667
#*# 	  0.810104, 0.801979, 0.732917, 0.684479, -0.017083, -0.025833, -0.034271, -0.006146, 0.014792, 0.029167, 0.084479, 0.110417, 0.144479, 0.167604, 0.190417
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 259.96000000000004
#*# min_y = 30.0
#*# max_y = 237.20000000000007
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = -0.012509836088802784
#*# xz_skew = 0.006866335269208183
#*# yz_skew = -0.0020082167607952217
#*#
#*# [skew_correction CaliLantern]
#*# xy_skew = -0.0063854694071408345
#*# xz_skew = 0.006866335269208183
#*# yz_skew = -0.0020082167607952217
#*#
#*# [skew_correction CaliLanternSkewCorrection]
#*# xy_skew = -0.006618610042261487
#*# xz_skew = 0.007205556817402124
#*# yz_skew = -0.0015415011299482707
